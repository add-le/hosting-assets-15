{"version":3,"names":["s3pTemperatureReportCss","S3pTemperatureReport","async","this","setTemperatureData","temperatureData","provider","events","inputId","find","e","states","statesSeleted","statesName","setNameOfSensor","datas","headTable","event","data","includes","push","RegExp","test","number","match","Object","keys","length","assign","ts","dataTable","dataChart","state","statesGroups","group","displayModule","findState","name","findEv","render","h","class","registration","prettyDate","start","end","display_start","display_end","map","Date","round"],"sources":["./src/components/s3p-temperature-report/s3p-temperature-report.css?tag=s3p-temperature-report","./src/components/s3p-temperature-report/s3p-temperature-report.tsx"],"sourcesContent":["@import \"../../../node_modules/@s3pweb/s3p-chart/dist/s3p-chart/s3p-chart.css\";\n\n/* impression */\nhtml {\n  -webkit-print-color-adjust: exact;\n}\n/* page */\nbody {\n  margin: 0;\n  background-color: white;\n}\nmain {\n  margin: 0px 10px 10px 10px;\n  font-size: 14px;\n}\n.report {\n  font-family: \"Open Sans\", \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n}\n/* table */\ntable{\n  width: 100%;\n  font-size: 11px;\n}\n.col-date{\n  width: 100px;\n}\ntable,\nth,\ntd {\n  border: 0.1px solid white;\n}\nth,\ntd {\n  padding: 1px;\n  text-align: center;\n}\nth {\n  text-transform: uppercase;\n  background: rgba(var(--primary-color-rgba, 249, 190, 31), 0.6);\n}\ntr:nth-child(even) {\n  background-color: #fff0ac;\n}\n/* chart */\n.container-temperature {\n  position: relative;\n  margin: 15px;\n}\n.userInput{\n  font-size: 12px;\n}\n.userInput label {\n  width: inherit !important;\n}\n.container-temperature  s3p-temperature .chartD3 {\n  height:inherit !important;\n  max-height: inherit !important;\n  width:inherit !important;\n  max-width: inherit !important;\n}\n","import '@s3pweb/s3p-chart';\nimport { Component, h, Prop, State, Watch } from '@stencil/core';\nimport { prettyDate, round } from '../../utils/utils';\n\n@Component({\n  tag: 's3p-temperature-report',\n  styleUrl: 's3p-temperature-report.css',\n  shadow: false,\n})\nexport class S3pTemperatureReport {\n  @Prop() registration: string;\n  @Prop() start;\n  @Prop() end;\n  @Prop() statesSeleted = [];\n  @Prop() provider: string;\n  @Prop() temperatureData;\n  @Prop() statesGroups = [];\n\n  @State() dataTable = [];\n  @State() headTable = [];\n  @State() dataChart = {};\n  @State() statesName = {};\n\n  async componentDidLoad() {\n    this.setTemperatureData();\n  }\n\n  @Watch('temperatureData')\n  setTemperatureData() {\n    if (this.temperatureData && this.temperatureData[this.provider] && this.temperatureData[this.provider].events) {\n      const inputId = this.temperatureData[this.provider].events.find(e => e['inputId']).inputId;\n      // set name col\n      for (const states of this.statesSeleted) {\n        this.statesName[states] = this.setNameOfSensor(states, this.temperatureData[this.provider].events, inputId);\n      }\n      // set data chart and table\n      const datas = [];\n      this.headTable = [];\n      const events = this.temperatureData[this.provider].events;\n      for (const event of events) {\n        const data = {};\n        for (const states of this.statesSeleted) {\n          if (event[states] != null) {\n            data[states] = event[states];\n            if (!this.headTable.includes(states)) {\n              this.headTable.push(states);\n            }\n            if (new RegExp('tempSensor(0?[1-9]|[1-9][0-9])Value').test(states)) {\n              const number = states.match(/\\d+/);\n              if (event[`tempSensor${number}Name`]) {\n                data[`tempSensor${number}Name`] = event[`tempSensor${number}Name`];\n              }\n            }\n          }\n        }\n        if (Object.keys(data).length > 0) {\n          datas.push({ ...data, ts: event.ts, inputId: event.inputId, provider: event.provider });\n        }\n      }\n      this.dataTable = datas;\n      this.dataChart[this.provider] = { events: datas };\n    }\n  }\n\n  setNameOfSensor(state, events, inputId) {\n    if (this.statesGroups && this.statesGroups.length) {\n      let states = [];\n      for (const group of this.statesGroups) {\n        if (group && group.displayModule === 'temperature') {\n          states = [...states, ...group.states];\n        }\n      }\n      const findState = states.find(e => e.inputId === inputId && state === e.state);\n      if (findState) {\n        return findState.name;\n      }\n    }\n    if (new RegExp('tempSensor(0?[1-9]|[1-9][0-9])Value').test(state)) {\n      const number = state.match(/\\d+/);\n      const findEv = events.find(e => e[`tempSensor${number}Name`]);\n      if (findEv) {\n        return findEv[`tempSensor${number}Name`];\n      } else {\n        return state;\n      }\n    } else {\n      return state;\n    }\n  }\n\n  render() {\n    return (\n      <div class=\"report\">\n        <report-header name={'Température'}></report-header>\n        <main>\n          <p>\n            Véhicule : <strong>{this.registration}</strong>\n          </p>\n          <p>\n            Période : Du <strong>{prettyDate(this.start)}</strong> au <strong>{prettyDate(this.end)}</strong>\n          </p>\n          <div class=\"container-temperature\">\n            {Object.keys(this.dataChart).length ? (\n              <s3p-temperature events={this.dataChart} display_start={this.start} display_end={this.end} statesGroups={this.statesGroups}></s3p-temperature>\n            ) : (\n              ''\n            )}\n          </div>\n          <table>\n            <thead>\n              <tr>\n                <th class=\"col-date\">Date</th>\n                {this.headTable.map(state => (\n                  <th>{this.statesName[state]}</th>\n                ))}\n              </tr>\n            </thead>\n            <tbody>\n              {this.dataTable.map(data => (\n                <tr>\n                  <td>{prettyDate(new Date(data.ts))}</td>\n                  {this.headTable.map(state => (\n                    <td>{data[state] != null ? round(data[state], 1) : ''}</td>\n                  ))}\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </main>\n      </div>\n    );\n  }\n}\n"],"mappings":"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"}