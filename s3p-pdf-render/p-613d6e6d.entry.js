import{r as t,c as e,g as i,h as r,a as n}from"./p-d5a6e412.js";import{b as s}from"./p-6f5893c5.js";import{m as a,i as o,s as h,a as c,l as u}from"./p-08d6daf2.js";import{m as f}from"./p-87ef56bd.js";import{c as l,m as d,a as m,b as p}from"./p-3dcb4c27.js";import{a as w}from"./p-98feef0c.js";import{i as v}from"./p-924cb6ab.js";import"./p-3e8ff66b.js";function y(t,e,i){t=+t,e=+e,i=(n=arguments.length)<2?(e=t,t=0,1):n<3?1:+i;var r=-1,n=Math.max(0,Math.ceil((e-t)/i))|0,s=new Array(n);while(++r<n){s[r]=t+r*i}return s}var b={name:"implicit"};function x(){var t=a(),e=[],i=[],r=b;function n(n){var s=n+"",a=t.get(s);if(!a){if(r!==b)return r;t.set(s,a=e.push(n))}return i[(a-1)%i.length]}n.domain=function(i){if(!arguments.length)return e.slice();e=[],t=a();var r=-1,s=i.length,o,h;while(++r<s)if(!t.has(h=(o=i[r])+""))t.set(h,e.push(o));return n};n.range=function(t){return arguments.length?(i=h.call(t),n):i.slice()};n.unknown=function(t){return arguments.length?(r=t,n):r};n.copy=function(){return x(e,i).unknown(r)};o.apply(n,arguments);return n}function D(){var t=x().unknown(undefined),e=t.domain,i=t.range,r=[0,1],n,s,a=false,h=0,c=0,u=.5;delete t.unknown;function f(){var t=e().length,o=r[1]<r[0],f=r[o-0],l=r[1-o];n=(l-f)/Math.max(1,t-h+c*2);if(a)n=Math.floor(n);f+=(l-f-n*(t-h))*u;s=n*(1-h);if(a)f=Math.round(f),s=Math.round(s);var d=y(t).map((function(t){return f+n*t}));return i(o?d.reverse():d)}t.domain=function(t){return arguments.length?(e(t),f()):e()};t.range=function(t){return arguments.length?(r=[+t[0],+t[1]],f()):r.slice()};t.rangeRound=function(t){return r=[+t[0],+t[1]],a=true,f()};t.bandwidth=function(){return s};t.step=function(){return n};t.round=function(t){return arguments.length?(a=!!t,f()):a};t.padding=function(t){return arguments.length?(h=Math.min(1,c=+t),f()):h};t.paddingInner=function(t){return arguments.length?(h=Math.min(1,t),f()):h};t.paddingOuter=function(t){return arguments.length?(c=+t,f()):c};t.align=function(t){return arguments.length?(u=Math.max(0,Math.min(1,t)),f()):u};t.copy=function(){return D(e(),r).round(a).paddingInner(h).paddingOuter(c).align(u)};return o.apply(f(),arguments)}var g=Array.prototype.slice;function k(t,e){if(!((a=t.length)>1))return;for(var i=1,r,n,s=t[e[0]],a,o=s.length;i<a;++i){n=s,s=t[e[i]];for(r=0;r<o;++r){s[r][1]+=s[r][0]=isNaN(n[r][1])?n[r][0]:n[r][1]}}}function M(t){var e=t.length,i=new Array(e);while(--e>=0)i[e]=e;return i}function j(t,e){return t[e]}function A(){var t=l([]),e=M,i=k,r=j;function n(n){var s=t.apply(this,arguments),a,o=n.length,h=s.length,c=new Array(h),u;for(a=0;a<h;++a){for(var f=s[a],l=c[a]=new Array(o),d=0,m;d<o;++d){l[d]=m=[0,+r(n[d],f,d,n)];m.data=n[d]}l.key=f}for(a=0,u=e(c);a<h;++a){c[u[a]].index=a}i(c,u);return c}n.keys=function(e){return arguments.length?(t=typeof e==="function"?e:l(g.call(e)),n):t};n.value=function(t){return arguments.length?(r=typeof t==="function"?t:l(+t),n):r};n.order=function(t){return arguments.length?(e=t==null?M:typeof t==="function"?t:l(g.call(t)),n):e};n.offset=function(t){return arguments.length?(i=t==null?k:t,n):i};return n}const z="";const R=class{constructor(r){t(this,r);this.displayPathEvent=e(this,"displayPathEvent",7);this.idChart="s3pCumulsByResource";this.margin={top:0,right:0,bottom:32,left:150};this.toHHMMSS=w;this.log=s("s3pChart:chartcumul");this.resourcesUrl=i(this,"resourcesUrl")}async componentWillLoad(){this.i18n=new v(this.element);await this.i18n.load(this.resourcesUrl)}async componentDidLoad(){this.totals=typeof this.totals==="string"?JSON.parse(this.totals):this.totals;this.height=90;this.chart_width=1e3-this.margin.left-this.margin.right;this.chart_height=this.height-this.margin.top-this.margin.bottom;this.initialization(this.height)}createPatternRest(){this.svg.append("defs").append("pattern").attr("id",(()=>"pattern-stripe2")).attr("width",6).attr("height",4).attr("patternUnits","userSpaceOnUse").attr("patternTransform","rotate(45)").append("rect").attr("width",2).attr("height",4).attr("transform","translate(0,0)").attr("fill","#ababab")}initialization(t){this.svg=c(`#${this.idChart}`).append("svg").attr("viewBox",`0 0 1020 ${t}`).attr("preserveAspectRadio","xMidYMid").append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")");var e=A().keys(["drive","work","available","rest"]);this.createPatternRest();this.stack_data=e(this.totals);this.layer=this.svg.selectAll(".layer").data(this.stack_data).enter().append("g").attr("class","layer").style("fill",(t=>{if(t.key==="drive"){return"var(--primary-drive-color,#01599d)"}if(t.key==="work"){return"var(--primary-work-color,#d0000d)"}if(t.key==="available"){return"var(--primary-available-color,#e67d20)"}if(t.key==="rest"){return"url(#pattern-stripe2)"}}));this.xScale=u().rangeRound([0,this.chart_width]).domain([0,f(this.stack_data,((t,e)=>f(t,(t=>t[1]))))]);this.yScale=D().rangeRound([this.chart_height,0]).padding(.1).domain(this.totals.map((function(t){return t.period})));this.createRect();this.createAxis();this.createLabel()}createRect(){var t=this.svg.append("g").attr("id","s3ptooltip").style("display","none");t.append("rect").attr("x",0).attr("y",0).attr("fill","black").attr("opacity",.7).attr("width",165).attr("height",82).attr("rx","5").attr("ry","5");let e=t.append("text").attr("x",0).attr("y",25).attr("fill","white").attr("font-size",25).attr("font-weight","bold");e.append("tspan").attr("x",165/2).attr("dy","0em").attr("id","activity").attr("text-anchor","middle").attr("dominant-baseline","middle");e.append("tspan").attr("x",165/2).attr("dy","1.5em").attr("id","time").attr("text-anchor","middle").attr("dominant-baseline","middle");let i=this;this.layer.selectAll("rect").data((t=>t)).enter().append("rect").attr("class","bar").attr("y",(t=>this.yScale(t.data.period))).attr("x",(t=>this.xScale(t[0]))).attr("height",this.yScale.bandwidth()).attr("width",(t=>this.xScale(t[1])-this.xScale(t[0]))).attr("cursor","pointer").on("click",(t=>{this.displayPath(t)})).on("mouseover",(e=>{t.style("display",null)})).on("mouseout",(function(){t.style("display","none")})).on("mousemove",(function(e){var r=d(this);var n=r[0]+10;if(n>700){n=700}let s=e[1]-e[0];t.attr("transform","translate("+n+","+0+")");t.select("text").select("#activity").text((()=>{for(const t of Object.keys(e.data)){if(e.data[t]===s){return i.i18n.get(t)}}}));t.select("text").select("#time").text((()=>i.toHHMMSS(s)))}))}createAxis(){this.xAxis=m(this.xScale).tickValues(this.setValueAxesX()).tickFormat((t=>this.toHHMMSS(t)));this.svg.append("g").attr("class","axis axis--x").attr("transform","translate(0,"+(this.chart_height+5)+")").call(this.xAxis).attr("font-size",23).attr("font-weight","bold");this.yAxis=p(this.yScale);this.svg.append("g").attr("class","axis axis--y").attr("transform","translate(0,0)").call(this.yAxis).selectAll(".tick text").call((t=>{this.addAxeYText(t)}))}addAxeYText(t){let e=this;t.each((function(t){var i=c(this);let r=e.i18n.get(t);i.text(r).attr("font-size",23).attr("font-weight","bold")}))}setValueAxesX(){var t=f(this.stack_data,((t,e)=>f(t,(function(t){return t[1]}))));let e=Math.floor(t/3600);let i=[];let r=Math.ceil(e/6);if(r!==0){for(let t=0;t<=e;){i.push(t*3600);t=t+r}}else{let e=Math.floor(t/60);let r=Math.ceil(e/6);if(r!==0){for(let t=0;t<=e;){i.push(t*60);t=t+r}}}return i}createLabel(){var t=this.layer.selectAll("text").data((function(t){return t})).enter();t.append("text").attr("stroke","white").attr("stroke-width",4).attr("stroke-linejoin","round").attr("font-size",26).attr("font-weight","bold").text((t=>{if(this.xScale(t[1])-this.xScale(t[0])>90){return this.toHHMMSS(t[1]-t[0])}})).attr("x",(t=>this.xScale(t[0])+(this.xScale(t[1])-this.xScale(t[0]))/2)).attr("y",(t=>this.yScale(t.data.period)+this.yScale.bandwidth()/2)).attr("cursor","pointer").on("click",(t=>{this.displayPath(t)})).attr("dominant-baseline","middle").attr("text-anchor",(t=>"middle"));t.append("text").attr("fill","black").attr("font-size",26).attr("font-weight","bold").text((t=>{if(this.xScale(t[1])-this.xScale(t[0])>90){return this.toHHMMSS(t[1]-t[0])}})).attr("x",(t=>this.xScale(t[0])+(this.xScale(t[1])-this.xScale(t[0]))/2)).attr("y",(t=>this.yScale(t.data.period)+this.yScale.bandwidth()/2)).attr("cursor","pointer").on("click",(t=>{this.displayPath(t)})).attr("dominant-baseline","middle").attr("text-anchor",(t=>"middle"))}displayPath(t){if(t.data.period){let e,i;const r=new Date;const n=new Date(r.setHours(0,0,0,0));const s=r.getDay();const a=new Date(r.setDate(r.getDate()-s+(s==0?-6:1))).setHours(0,0,0,0);const o=new Date(r.setDate(r.getDate()-7)).setHours(0,0,0,0);switch(t.data.period){case"day":e=n;i=new Date((new Date).setHours(23,59,59,59));break;case"yesterday":e=new Date((new Date).setDate((new Date).getDate()-1)).setHours(0,0,0,0);i=n;break;case"week":e=new Date(a);i=new Date((new Date).setHours(23,59,59,59));break;case"twoWeeks":e=new Date(o);i=new Date((new Date).setHours(23,59,59,59));break;case"fourWeeks":const t=new Date(r.setDate(new Date(o).getDate()-14)).setHours(0,0,0,0);e=new Date(t);i=new Date((new Date).setHours(23,59,59,59));break;case"month":const s=new Date((new Date).setDate(1));e=new Date(s.setHours(0,0,0,0));i=new Date((new Date).setHours(23,59,59,59));break}this.displayPathEvent.emit({start:new Date(e),end:new Date(i)})}}componentDidUpdate(){this.log("totals change",this.totals);c(`#${this.idChart}`).selectAll("svg").remove();this.totals=typeof this.totals==="string"?JSON.parse(this.totals):this.totals;this.initialization(this.height)}render(){return r("div",{class:"s3pchart"},r("div",{id:this.idChart,class:"chartCumulsByResource"}))}get element(){return n(this)}};R.style=z;export{R as s3p_chart_cumul};
//# sourceMappingURL=p-613d6e6d.entry.js.map