{"version":3,"names":["chartLevelCss","ChartLevel","constructor","hostRef","this","idChart","margin","top","right","bottom","left","time_format","d3.timeFormat","log","debug","async","i18n","element","load","resourcesUrl","levels","JSON","parse","chart_width","chart_height","initialization","start","end","events","lastEvent_end","d3.select","selectAll","remove","display_start","display_end","eventsTimeline","svg","append","attr","x_scale","d3.scaleTime","domain","range","y_scale","d3.scaleLinear","x_axis","d3.axisBottom","ticks","tickFormat","y_axis","d3.axisLeft","d","call","data","drawTimeline","createLine","setTooltipMultiLine","type","color","filter","level","Date","ts","sort","a","b","datum","d3.line","x","y","push","value","key","that","mouseG","res_nested","d3.nest","entries","style","mousePerLine","enter","on","select","coords","d3.mouse","xDate","invert","bisect","d3.bisector","xValue","html","d3.selectAll","i","idx","values","toLocaleString","Math","round","divSize","document","getElementById","clientWidth","divSizeHeight","clientHeight","mouse","event","map","clickLevel","emit","previousEvent","index","Object","keys","activity","render","h","class","id"],"sources":["./node_modules/@s3pweb/s3p-chart/dist/collection/components/chartLevel/chartLevel.css?tag=s3p-chart-level","./node_modules/@s3pweb/s3p-chart/dist/collection/components/chartLevel/chartLevel.js"],"sourcesContent":["#tooltipLevel {\n    position: absolute;\n    width: 150px;\n    padding: 10px;\n    background-color: white;\n    border-radius: 5px;\n    border: 1px solid #000;\n    pointer-events: none;\n    display: none;\n    font-family: sans-serif;\n    font-size: 12px;\n    font-weight: bold;\n  }\n  #tooltipLevel p{\n      margin: 3px;\n      text-align: center;\n      font-size: 14px;\n  }\n  #s3pChartLevel{\n      position: relative;\n  }","import { Component, h, Prop, Element, State, Event, Method } from '@stencil/core';\nimport debug from \"debug/src/browser\";\nimport { i18n } from '../../utils/i18n';\nimport * as d3 from 'd3';\nexport class ChartLevel {\n    constructor() {\n        this.idChart = 's3pChartLevel';\n        this.margin = { top: 20, right: 50, bottom: 70, left: 50 };\n        this.time_format = d3.timeFormat('%d-%m-%Y - %H-%M');\n        this.log = debug('s3pChart:chartLevel');\n    }\n    async componentWillLoad() {\n        this.i18n = new i18n(this.element);\n        await this.i18n.load(this.resourcesUrl);\n        this.levels = typeof this.levels === \"string\" ? JSON.parse(this.levels) : this.levels;\n        this.chart_width = 1000 - this.margin.left - this.margin.right;\n        this.chart_height = 300 - this.margin.top - this.margin.bottom;\n    }\n    async componentDidLoad() {\n        this.initialization();\n    }\n    async updateData(levels, start, end, events, lastEvent_end) {\n        this.log('levels change', this.levels);\n        d3.select(`#${this.idChart}`).selectAll('svg').remove();\n        this.levels = typeof levels === \"string\" ? JSON.parse(levels) : levels;\n        this.display_start = start;\n        this.display_end = end;\n        this.eventsTimeline = events;\n        this.lastEvent_end = lastEvent_end;\n        this.initialization();\n    }\n    initialization() {\n        this.log(\"initialization\");\n        this.svg = d3.select(`#${this.idChart}`)\n            .append(\"svg\")\n            // responsive\n            .attr('preserveAspectRadio', 'xMidYMid')\n            .attr(\"viewBox\", `0 0 1000 300`)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + this.margin.left + \",\" + this.margin.top + \")\");\n        if (this.levels && this.levels[0] && this.display_end && this.display_start) {\n            this.x_scale = d3.scaleTime()\n                .domain([\n                this.display_start,\n                this.display_end\n            ])\n                .range([0, this.chart_width]);\n            this.y_scale = d3.scaleLinear()\n                .domain([\n                0, 100\n            ])\n                .range([this.chart_height, 0]);\n            this.x_axis = d3.axisBottom(this.x_scale)\n                .ticks(8)\n                .tickFormat(this.time_format);\n            this.y_axis = d3.axisLeft(this.y_scale)\n                .ticks(8)\n                .tickFormat(d => d + ' %');\n            this.svg.append(\"g\")\n                .attr(\"transform\", \"translate(0,\" + (this.chart_height) + \")\")\n                .call(this.x_axis);\n            this.svg.append(\"g\")\n                .attr(\"transform\", \"translate(\" + 0 + \",0)\")\n                .call(this.y_axis);\n            this.data = [];\n            this.drawTimeline();\n            this.createLine('fuelLevel', 'red');\n            this.createLine('adBlueLevel', 'blue');\n            this.setTooltipMultiLine();\n        }\n    }\n    createLine(type, color) {\n        let data = this.levels.filter(level => level && level[type] && new Date(level.ts) > new Date(this.display_start) && new Date(level.ts) < new Date(this.display_end));\n        data.sort(((a, b) => +new Date(a.ts) - +new Date(b.ts)));\n        this.svg\n            .append(\"path\")\n            .datum(data)\n            .attr(\"fill\", \"none\")\n            .attr('class', type)\n            .attr(\"stroke\", color)\n            .attr(\"stroke-width\", 1.5)\n            .attr(\"d\", d3.line()\n            .x((d) => {\n            return this.x_scale(new Date(d.ts));\n        })\n            .y((d) => { return this.y_scale(d[type]); }));\n        for (let level of this.levels) {\n            if (new Date(level.ts) > new Date(this.display_start) && new Date(level.ts) < new Date(this.display_end)) {\n                if (level[type]) {\n                    this.data.push({ value: level[type], ts: new Date(level.ts), key: type, color: color });\n                }\n                else {\n                    this.data.push({ value: 'Inconnu', ts: new Date(level.ts), key: type, color: color });\n                }\n            }\n        }\n    }\n    setTooltipMultiLine() {\n        d3.select(`#${this.idChart}`).append(\"div\")\n            .attr('id', 'tooltipLevel');\n        let that = this;\n        let mouseG = this.svg.append(\"g\")\n            .attr(\"class\", \"mouse-over-effects-level\");\n        let res_nested = d3.nest()\n            .key(d => d.key)\n            .entries(this.data);\n        mouseG.append(\"path\") // create vertical line to follow mouse\n            .attr(\"class\", \"mouse-line-level\")\n            //.style(\"stroke\", \"#A9A9A9\")\n            .style(\"stroke\", \"#2c3e50\")\n            .style(\"stroke-width\", \"1px\")\n            .style(\"height\", \"20px\")\n            .style(\"opacity\", \"0\");\n        let mousePerLine = mouseG.selectAll('.mouse-per-line-level')\n            .data(res_nested)\n            .enter()\n            .append(\"g\")\n            .attr(\"class\", \"mouse-per-line-level\");\n        mousePerLine.append(\"circle\")\n            .attr(\"r\", 4)\n            .style(\"stroke\", 'black')\n            .style(\"fill\", \"none\")\n            .style(\"stroke-width\", \"1px\")\n            .style(\"opacity\", \"0\");\n        mouseG.append('svg:rect') // append a rect to catch mouse movements on canvas\n            .attr('width', this.chart_width)\n            .attr('height', this.chart_height)\n            .attr('fill', 'none')\n            .attr('pointer-events', 'all')\n            .on('mouseout', function () {\n            d3.select(`#${that.idChart}`).select(\".mouse-line-level\")\n                .style(\"opacity\", \"0\");\n            d3.select(`#${that.idChart}`).selectAll(\".mouse-per-line-level circle\")\n                .style(\"opacity\", \"0\");\n            d3.select(`#${that.idChart}`).selectAll(\".mouse-per-line-level text\")\n                .style(\"opacity\", \"0\");\n            d3.select(`#${that.idChart}`).selectAll(\"#tooltipLevel\")\n                .style('display', 'none');\n        })\n            .on('mouseover', function () {\n            d3.select(`#${that.idChart}`).select(\".mouse-line-level\")\n                .style(\"opacity\", \"1\");\n            d3.select(`#${that.idChart}`).selectAll(\".mouse-per-line-level circle\")\n                .style(\"opacity\", \"1\");\n            d3.select(`#${that.idChart}`).selectAll(\"#tooltipLevel\")\n                .style('display', 'block');\n        })\n            .on(\"mousemove\", function (d) {\n            let coords = d3.mouse(this);\n            let xDate = that.x_scale.invert(coords[0]);\n            let bisect = d3.bisector(function (d) { return d.ts; }).left;\n            let xValue, html = '';\n            d3.selectAll(\".mouse-per-line-level\")\n                .attr(\"transform\", function (d, i) {\n                let idx = bisect(d.values, xDate);\n                if (d.values[idx] && d.values[idx].ts) {\n                    if (!xValue) {\n                        html += `<p>${d.values[idx].ts.toLocaleString(\"fr-FR\")}</p>`;\n                    }\n                    xValue = that.x_scale(d.values[idx].ts);\n                    html += `<p style=\"color:${d.values[idx].color};\" >${d.key} : ${d.values[idx].value !== 'Inconnu' ? `${Math.round(d.values[idx].value * 100) / 100}%` : d.values[idx].value}</p>`;\n                    d3.select(`#${that.idChart}`).select(\".mouse-line-level\")\n                        .attr(\"d\", function () {\n                        let data = \"M\" + that.x_scale(d.values[idx].ts) + \",\" + (7 * that.chart_height + that.margin.bottom / 8);\n                        data += \" \" + that.x_scale(d.values[idx].ts) + \",\" + (4 * 0 / 5);\n                        return data;\n                    });\n                    if (d.values[idx].value && that.y_scale(d.values[idx].value)) {\n                        return \"translate(\" + that.x_scale(d.values[idx].ts) + \",\" + that.y_scale(d.values[idx].value) + \")\";\n                    }\n                    else {\n                        return \"translate(-10 ,-10)\";\n                    }\n                }\n            });\n            if (xValue) {\n                let divSize = document.getElementById(that.idChart).clientWidth;\n                let divSizeHeight = document.getElementById(that.idChart).clientHeight;\n                let x = (divSize * xValue / (1000)) + 70;\n                let y = (divSizeHeight * ((that.chart_height + that.margin.top) / 3) / (that.chart_height + that.margin.top));\n                if (x + 150 > divSize) {\n                    x = x - 200;\n                }\n                d3.select(`#${that.idChart}`).selectAll(\"#tooltipLevel\").html('')\n                    .style('left', x + 'px')\n                    .style('top', y + 'px')\n                    .style('display', 'block')\n                    .append('div')\n                    .html(d => {\n                    return html;\n                });\n            }\n        })\n            .on(\"click\", function (d) {\n            let mouse = d3.mouse(this);\n            let event = {};\n            res_nested.map(d => {\n                let xDate = that.x_scale.invert(mouse[0]);\n                let bisect = d3.bisector(function (d) { return d.ts; }).left;\n                let idx = bisect(d.values, xDate);\n                if (d.values[idx]) {\n                    event[d.values[idx].key] = d.values[idx].value;\n                    event['ts'] = d.values[idx].ts;\n                }\n            });\n            that.clickLevel.emit(event);\n        });\n    }\n    drawTimeline() {\n        let data = [];\n        if (this.eventsTimeline && this.eventsTimeline[0]) {\n            let previousEvent;\n            for (let index of Object.keys(this.eventsTimeline)) {\n                let event = this.eventsTimeline[index];\n                if (event.activity && event.ts && new Date(event.ts) <= new Date(this.display_end)) {\n                    if (event.activity === \"U\") {\n                        event.activity = \"R\";\n                    }\n                    if (!previousEvent) {\n                        previousEvent = event;\n                    }\n                    else {\n                        if (event.activity !== previousEvent.activity) {\n                            data.push({ activity: previousEvent.activity, start: previousEvent.ts, end: event.ts });\n                            previousEvent = event;\n                        }\n                    }\n                }\n            }\n            if (this.lastEvent_end && new Date(this.lastEvent_end) <= new Date(this.display_end)) {\n                data.push({ activity: previousEvent.activity, start: previousEvent.ts, end: this.lastEvent_end });\n            }\n        }\n        this.svg.append(\"g\")\n            .attr('class', 'timeline').selectAll(\"rect\")\n            .data(data)\n            .enter().append(\"rect\")\n            .attr(\"class\", \"bar\")\n            .attr(\"x\", (d) => {\n            return this.x_scale(new Date(d.start));\n        })\n            .attr(\"y\", (d) => {\n            switch (d.activity) {\n                case \"D\":\n                    return this.chart_height + this.margin.bottom - 45;\n                case \"W\":\n                    return this.chart_height + this.margin.bottom - 35;\n                case \"A\":\n                    return this.chart_height + this.margin.bottom - 25;\n                case \"R\":\n                    return this.chart_height + this.margin.bottom - 15;\n            }\n        })\n            .attr(\"width\", (d) => {\n            return this.x_scale(new Date(d.end)) - this.x_scale(new Date(d.start));\n        })\n            .style(\"fill\", (d) => {\n            switch (d.activity) {\n                case \"D\":\n                    return 'var(--primary-drive-color, #01599d)';\n                case \"W\":\n                    return 'var(--primary-work-color, #d0000d)';\n                case \"A\":\n                    return 'var(--primary-available-color, #e67d20)';\n                case \"R\":\n                    return 'var(--primary-rest-color, #2f7f33)';\n            }\n        })\n            .style(\"opacity\", 0.7)\n            .attr(\"height\", (d) => {\n            switch (d.activity) {\n                case \"D\":\n                    return 45;\n                case \"W\":\n                    return 35;\n                case \"A\":\n                    return 25;\n                case \"R\":\n                    return 15;\n            }\n        });\n    }\n    render() {\n        return (h(\"div\", { class: \"s3pchartLevel\" },\n            h(\"div\", { id: this.idChart, class: 'chartCumulsByResource' })));\n    }\n    static get is() { return \"s3p-chart-level\"; }\n    static get originalStyleUrls() { return {\n        \"$\": [\"chartLevel.css\"]\n    }; }\n    static get styleUrls() { return {\n        \"$\": [\"chartLevel.css\"]\n    }; }\n    static get properties() { return {\n        \"idChart\": {\n            \"type\": \"string\",\n            \"mutable\": false,\n            \"complexType\": {\n                \"original\": \"string\",\n                \"resolved\": \"string\",\n                \"references\": {}\n            },\n            \"required\": false,\n            \"optional\": false,\n            \"docs\": {\n                \"tags\": [],\n                \"text\": \"\"\n            },\n            \"attribute\": \"id-chart\",\n            \"reflect\": false,\n            \"defaultValue\": \"'s3pChartLevel'\"\n        },\n        \"display_start\": {\n            \"type\": \"unknown\",\n            \"mutable\": false,\n            \"complexType\": {\n                \"original\": \"Date\",\n                \"resolved\": \"Date\",\n                \"references\": {\n                    \"Date\": {\n                        \"location\": \"global\"\n                    }\n                }\n            },\n            \"required\": false,\n            \"optional\": false,\n            \"docs\": {\n                \"tags\": [],\n                \"text\": \"\"\n            }\n        },\n        \"display_end\": {\n            \"type\": \"unknown\",\n            \"mutable\": false,\n            \"complexType\": {\n                \"original\": \"Date\",\n                \"resolved\": \"Date\",\n                \"references\": {\n                    \"Date\": {\n                        \"location\": \"global\"\n                    }\n                }\n            },\n            \"required\": false,\n            \"optional\": false,\n            \"docs\": {\n                \"tags\": [],\n                \"text\": \"\"\n            }\n        },\n        \"levels\": {\n            \"type\": \"unknown\",\n            \"mutable\": false,\n            \"complexType\": {\n                \"original\": \"any[]\",\n                \"resolved\": \"any[]\",\n                \"references\": {}\n            },\n            \"required\": false,\n            \"optional\": false,\n            \"docs\": {\n                \"tags\": [],\n                \"text\": \"\"\n            }\n        },\n        \"eventsTimeline\": {\n            \"type\": \"any\",\n            \"mutable\": false,\n            \"complexType\": {\n                \"original\": \"any\",\n                \"resolved\": \"any\",\n                \"references\": {}\n            },\n            \"required\": false,\n            \"optional\": false,\n            \"docs\": {\n                \"tags\": [],\n                \"text\": \"\"\n            },\n            \"attribute\": \"events-timeline\",\n            \"reflect\": false\n        },\n        \"lastEvent_end\": {\n            \"type\": \"unknown\",\n            \"mutable\": false,\n            \"complexType\": {\n                \"original\": \"Date\",\n                \"resolved\": \"Date\",\n                \"references\": {\n                    \"Date\": {\n                        \"location\": \"global\"\n                    }\n                }\n            },\n            \"required\": false,\n            \"optional\": false,\n            \"docs\": {\n                \"tags\": [],\n                \"text\": \"\"\n            }\n        }\n    }; }\n    static get contextProps() { return [{\n            \"name\": \"resourcesUrl\",\n            \"context\": \"resourcesUrl\"\n        }]; }\n    static get states() { return {\n        \"data\": {}\n    }; }\n    static get events() { return [{\n            \"method\": \"clickLevel\",\n            \"name\": \"clickLevel\",\n            \"bubbles\": true,\n            \"cancelable\": true,\n            \"composed\": true,\n            \"docs\": {\n                \"tags\": [],\n                \"text\": \"\"\n            },\n            \"complexType\": {\n                \"original\": \"any\",\n                \"resolved\": \"any\",\n                \"references\": {}\n            }\n        }]; }\n    static get methods() { return {\n        \"updateData\": {\n            \"complexType\": {\n                \"signature\": \"(levels: any, start: any, end: any, events: any, lastEvent_end: any) => Promise<void>\",\n                \"parameters\": [{\n                        \"tags\": [],\n                        \"text\": \"\"\n                    }, {\n                        \"tags\": [],\n                        \"text\": \"\"\n                    }, {\n                        \"tags\": [],\n                        \"text\": \"\"\n                    }, {\n                        \"tags\": [],\n                        \"text\": \"\"\n                    }, {\n                        \"tags\": [],\n                        \"text\": \"\"\n                    }],\n                \"references\": {\n                    \"Promise\": {\n                        \"location\": \"global\"\n                    }\n                },\n                \"return\": \"Promise<void>\"\n            },\n            \"docs\": {\n                \"text\": \"\",\n                \"tags\": []\n            }\n        }\n    }; }\n    static get elementRef() { return \"element\"; }\n}\n"],"mappings":"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"}