import{r as t,c as e,g as i,h as s,a as l}from"./p-d5a6e412.js";import{b as r}from"./p-6f5893c5.js";import{i as a}from"./p-924cb6ab.js";import{a as o,l as n,b as h}from"./p-08d6daf2.js";import{a as c,b as p,m as f}from"./p-3dcb4c27.js";import{t as u,n as d,s as m}from"./p-d78cdf42.js";import{t as v,l as w}from"./p-affb5605.js";import"./p-3e8ff66b.js";const y="#tooltipLevel{position:absolute;width:150px;padding:10px;background-color:white;border-radius:5px;border:1px solid #000;pointer-events:none;display:none;font-family:sans-serif;font-size:12px;font-weight:bold}#tooltipLevel p{margin:3px;text-align:center;font-size:14px}#s3pChartLevel{position:relative}";const D=class{constructor(s){t(this,s);this.clickLevel=e(this,"clickLevel",7);this.idChart="s3pChartLevel";this.margin={top:20,right:50,bottom:70,left:50};this.time_format=u("%d-%m-%Y - %H-%M");this.log=r("s3pChart:chartLevel");this.resourcesUrl=i(this,"resourcesUrl")}async componentWillLoad(){this.i18n=new a(this.element);await this.i18n.load(this.resourcesUrl);this.levels=typeof this.levels==="string"?JSON.parse(this.levels):this.levels;this.chart_width=1e3-this.margin.left-this.margin.right;this.chart_height=300-this.margin.top-this.margin.bottom}async componentDidLoad(){this.initialization()}async updateData(t,e,i,s,l){this.log("levels change",this.levels);o(`#${this.idChart}`).selectAll("svg").remove();this.levels=typeof t==="string"?JSON.parse(t):t;this.display_start=e;this.display_end=i;this.eventsTimeline=s;this.lastEvent_end=l;this.initialization()}initialization(){this.log("initialization");this.svg=o(`#${this.idChart}`).append("svg").attr("preserveAspectRadio","xMidYMid").attr("viewBox",`0 0 1000 300`).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")");if(this.levels&&this.levels[0]&&this.display_end&&this.display_start){this.x_scale=v().domain([this.display_start,this.display_end]).range([0,this.chart_width]);this.y_scale=n().domain([0,100]).range([this.chart_height,0]);this.x_axis=c(this.x_scale).ticks(8).tickFormat(this.time_format);this.y_axis=p(this.y_scale).ticks(8).tickFormat((t=>t+" %"));this.svg.append("g").attr("transform","translate(0,"+this.chart_height+")").call(this.x_axis);this.svg.append("g").attr("transform","translate("+0+",0)").call(this.y_axis);this.data=[];this.drawTimeline();this.createLine("fuelLevel","red");this.createLine("adBlueLevel","blue");this.setTooltipMultiLine()}}createLine(t,e){let i=this.levels.filter((e=>e&&e[t]&&new Date(e.ts)>new Date(this.display_start)&&new Date(e.ts)<new Date(this.display_end)));i.sort(((t,e)=>+new Date(t.ts)-+new Date(e.ts)));this.svg.append("path").datum(i).attr("fill","none").attr("class",t).attr("stroke",e).attr("stroke-width",1.5).attr("d",w().x((t=>this.x_scale(new Date(t.ts)))).y((e=>this.y_scale(e[t]))));for(let i of this.levels){if(new Date(i.ts)>new Date(this.display_start)&&new Date(i.ts)<new Date(this.display_end)){if(i[t]){this.data.push({value:i[t],ts:new Date(i.ts),key:t,color:e})}else{this.data.push({value:"Inconnu",ts:new Date(i.ts),key:t,color:e})}}}}setTooltipMultiLine(){o(`#${this.idChart}`).append("div").attr("id","tooltipLevel");let t=this;let e=this.svg.append("g").attr("class","mouse-over-effects-level");let i=d().key((t=>t.key)).entries(this.data);e.append("path").attr("class","mouse-line-level").style("stroke","#2c3e50").style("stroke-width","1px").style("height","20px").style("opacity","0");let s=e.selectAll(".mouse-per-line-level").data(i).enter().append("g").attr("class","mouse-per-line-level");s.append("circle").attr("r",4).style("stroke","black").style("fill","none").style("stroke-width","1px").style("opacity","0");e.append("svg:rect").attr("width",this.chart_width).attr("height",this.chart_height).attr("fill","none").attr("pointer-events","all").on("mouseout",(function(){o(`#${t.idChart}`).select(".mouse-line-level").style("opacity","0");o(`#${t.idChart}`).selectAll(".mouse-per-line-level circle").style("opacity","0");o(`#${t.idChart}`).selectAll(".mouse-per-line-level text").style("opacity","0");o(`#${t.idChart}`).selectAll("#tooltipLevel").style("display","none")})).on("mouseover",(function(){o(`#${t.idChart}`).select(".mouse-line-level").style("opacity","1");o(`#${t.idChart}`).selectAll(".mouse-per-line-level circle").style("opacity","1");o(`#${t.idChart}`).selectAll("#tooltipLevel").style("display","block")})).on("mousemove",(function(e){let i=f(this);let s=t.x_scale.invert(i[0]);let l=h((function(t){return t.ts})).left;let r,a="";m(".mouse-per-line-level").attr("transform",(function(e,i){let n=l(e.values,s);if(e.values[n]&&e.values[n].ts){if(!r){a+=`<p>${e.values[n].ts.toLocaleString("fr-FR")}</p>`}r=t.x_scale(e.values[n].ts);a+=`<p style="color:${e.values[n].color};" >${e.key} : ${e.values[n].value!=="Inconnu"?`${Math.round(e.values[n].value*100)/100}%`:e.values[n].value}</p>`;o(`#${t.idChart}`).select(".mouse-line-level").attr("d",(function(){let i="M"+t.x_scale(e.values[n].ts)+","+(7*t.chart_height+t.margin.bottom/8);i+=" "+t.x_scale(e.values[n].ts)+","+4*0/5;return i}));if(e.values[n].value&&t.y_scale(e.values[n].value)){return"translate("+t.x_scale(e.values[n].ts)+","+t.y_scale(e.values[n].value)+")"}else{return"translate(-10 ,-10)"}}}));if(r){let e=document.getElementById(t.idChart).clientWidth;let i=document.getElementById(t.idChart).clientHeight;let s=e*r/1e3+70;let l=i*((t.chart_height+t.margin.top)/3)/(t.chart_height+t.margin.top);if(s+150>e){s=s-200}o(`#${t.idChart}`).selectAll("#tooltipLevel").html("").style("left",s+"px").style("top",l+"px").style("display","block").append("div").html((t=>a))}})).on("click",(function(e){let s=f(this);let l={};i.map((e=>{let i=t.x_scale.invert(s[0]);let r=h((function(t){return t.ts})).left;let a=r(e.values,i);if(e.values[a]){l[e.values[a].key]=e.values[a].value;l["ts"]=e.values[a].ts}}));t.clickLevel.emit(l)}))}drawTimeline(){let t=[];if(this.eventsTimeline&&this.eventsTimeline[0]){let e;for(let i of Object.keys(this.eventsTimeline)){let s=this.eventsTimeline[i];if(s.activity&&s.ts&&new Date(s.ts)<=new Date(this.display_end)){if(s.activity==="U"){s.activity="R"}if(!e){e=s}else{if(s.activity!==e.activity){t.push({activity:e.activity,start:e.ts,end:s.ts});e=s}}}}if(this.lastEvent_end&&new Date(this.lastEvent_end)<=new Date(this.display_end)){t.push({activity:e.activity,start:e.ts,end:this.lastEvent_end})}}this.svg.append("g").attr("class","timeline").selectAll("rect").data(t).enter().append("rect").attr("class","bar").attr("x",(t=>this.x_scale(new Date(t.start)))).attr("y",(t=>{switch(t.activity){case"D":return this.chart_height+this.margin.bottom-45;case"W":return this.chart_height+this.margin.bottom-35;case"A":return this.chart_height+this.margin.bottom-25;case"R":return this.chart_height+this.margin.bottom-15}})).attr("width",(t=>this.x_scale(new Date(t.end))-this.x_scale(new Date(t.start)))).style("fill",(t=>{switch(t.activity){case"D":return"var(--primary-drive-color, #01599d)";case"W":return"var(--primary-work-color, #d0000d)";case"A":return"var(--primary-available-color, #e67d20)";case"R":return"var(--primary-rest-color, #2f7f33)"}})).style("opacity",.7).attr("height",(t=>{switch(t.activity){case"D":return 45;case"W":return 35;case"A":return 25;case"R":return 15}}))}render(){return s("div",{class:"s3pchartLevel"},s("div",{id:this.idChart,class:"chartCumulsByResource"}))}get element(){return l(this)}};D.style=y;export{D as s3p_chart_level};
//# sourceMappingURL=p-df2cf333.entry.js.map