import{r as e,c as t,h as n,a as r}from"./p-d5a6e412.js";import{b as i}from"./p-6f5893c5.js";import{h as s,a,l}from"./p-08d6daf2.js";import{u as f,t as o,m as c,g as u,f as h,h as d,n as g,s as w}from"./p-d78cdf42.js";import{a as m}from"./p-98feef0c.js";import"./p-3e8ff66b.js";function b(e,t){var n=e.length,r=-1,i,s,a;if(t==null){while(++r<n){if((i=e[r])!=null&&i>=i){s=a=i;while(++r<n){if((i=e[r])!=null){if(s>i)s=i;if(a<i)a=i}}}}}else{while(++r<n){if((i=t(e[r],r,e))!=null&&i>=i){s=a=i;while(++r<n){if((i=t(e[r],r,e))!=null){if(s>i)s=i;if(a<i)a=i}}}}}return[s,a]}function y(e,t){var n=e.length,r=-1,i,s=0;if(t==null){while(++r<n){if(i=+e[r])s+=i}}else{while(++r<n){if(i=+t(e[r],r,e))s+=i}}return s}function p(e){var t=e.length/6|0,n=new Array(t),r=0;while(r<t)n[r]="#"+e.slice(r*6,++r*6);return n}function v(e){return s(e[e.length-1])}var D=new Array(3).concat("ece7f2a6bddb2b8cbe","f1eef6bdc9e174a9cf0570b0","f1eef6bdc9e174a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf2b8cbe045a8d","f1eef6d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0034e7b","fff7fbece7f2d0d1e6a6bddb74a9cf3690c00570b0045a8d023858").map(p);const x=v(D);const k="s3p-legal-files #legalFilesChart{margin:10px 20px}s3p-legal-files .month{margin-right:8px}s3p-legal-files .month-name{font-size:60%;fill:#777;font-family:Arial, Helvetica}s3p-legal-files .day.hover{stroke:#6d6e70;stroke-width:2}s3p-legal-files .day.focus{stroke:#ffff33;stroke-width:2}s3p-legal-files .cross.hover{stroke:#6d6e70;stroke-width:2}s3p-legal-files .cross.focus{stroke:#ffff33;stroke-width:2}";const C=class{constructor(n){e(this,n);this.dayClicked=t(this,"dayClicked",7);this.idChart="legalFilesChart";this.legalFiles=[];this.language="fr";this.data=[];this.creationDates=[];this.time_parse=f("%Y-%m-%dT%H:%M:%S.%LZ");this.time_format=o("%m-%d-%Y - %H-%M");this.chart_width=1e3;this.chart_height=300;this.padding=75;this.monthArrayFr=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"];this.monthArrayEn=["January","February","March","April","May","June","July","August","September","October","November","December"];localStorage.debug="*";this.log=i("s3pChart:legalfile");this.toHHMMSS=m}onChangeLegalFiles(){if(typeof this.legalFiles==="string"){this.refresh()}}onChangeStart(){this.refresh()}onChangeEnd(){this.refresh()}onChangeLanguage(){this.refresh()}async componentDidLoad(){this.init()}formateDataToVisualize(e){let t=[];this.creationDates=[];for(let t of e){this.creationDates=[...this.creationDates,{day:new Date(t.file.date).toISOString().split("T")[0],legalFiles:[],isCreationDate:true,withPeriods:t.periods&&t.periods.length?true:false}]}for(let n of e){let e=[];if(n.periods&&n.periods.length){e=this.convertPeriodsToDaysArray(n.periods)}for(let r of e){let e=t.findIndex((e=>e.day===r));if(e!==-1){t[e].legalFiles=[...t[e].legalFiles,n]}else{t=[...t,{day:r,legalFiles:[n]}]}}}return t}convertPeriodsToDaysArray(e){let t=[];for(let n of e){let e=new Date(n.start);let r=new Date(n.end);r.setDate(r.getDate()+1);e.setHours(8,0,0,0);r.setHours(8,0,0,0);while(new Date(e)<new Date(r)){const n=e.toISOString().split("T")[0];if(!t.some((e=>e===n))){t=[...t,n]}let r=new Date(e);r.setDate(e.getDate()+1);e=r}}return t}refresh(){a(`#${this.idChart}`).selectAll("*").remove();a(`#legend-${this.idChart}`).selectAll("*").remove();this.haveLegend=false;this.init()}init(){if(typeof this.legalFiles==="string"){this.legalFiles=JSON.parse(this.legalFiles)}this.data=this.formateDataToVisualize(this.legalFiles);this.drawCalendar(this.data)}startchrono(e){console.time(e)}formatDate(e){const t=e.getFullYear();const n=e.getMonth()+1;const r=e.getDate();return`${t}-${n<10?"0":""}${n}-${r<10?"0":""}${r}`}endchrono(e){console.timeEnd(e)}drawCalendar(e){let t=this;var n=function(e){var t=c.floor(e);return u(h.floor(t),c.offset(t,1)).length};let r=new Date(t.start);let i=new Date(t.end);let s=1.3;let f=13;let m=o("%w");let p=o("%U");let v=o("%Y-%m-%d");let D=o("%d-%m-%Y");let k=c.range(c.floor(r),i);var C=a(`#${t.idChart}`).selectAll("svg").data(k).enter().append("svg").attr("class","month").attr("height",f*7+s*8+20).attr("width",(function(e){var t=n(e);return f*t+s*(t+1)})).append("g");C.append("text").attr("class","month-name").attr("y",f*7+s*8+15).attr("x",(function(e){var t=n(e);return(f*t+s*(t+1))/2})).attr("text-anchor","middle").text((function(e){let n=new Date(e);let r=n.getFullYear();let i=n.getMonth();let s=t.language.toLocaleLowerCase();if(s==="fr"){return t.monthArrayFr[i]+` ${r}`}else{return t.monthArrayEn[i]+` ${r}`}}));var $=C.selectAll("rect.day").data((function(e,t){return d(e,new Date(e.getFullYear(),e.getMonth()+1,1))})).enter().append("rect").attr("class","day").attr("width",f).attr("height",f).attr("rx",3).attr("ry",3).attr("fill","#eaeaea").attr("y",(function(e){return m(e)*f+m(e)*s+s})).attr("x",(function(e){return(p(e)-p(new Date(e.getFullYear(),e.getMonth(),1)))*f+(p(e)-p(new Date(e.getFullYear(),e.getMonth(),1)))*s+s})).on("mouseover",(function(e){a(this).classed("hover",true)})).on("mouseout",(function(e){a(this).classed("hover",false)})).on("click",(function(e){const n=t.formatDate(new Date(e));let r=t.data.find((e=>e&&e.day&&e.day===n));if(r){t.dayClicked.emit(r)}else{t.dayClicked.emit({day:n,legalFiles:[]})}})).datum(v);$.append("title").text((function(e){return D(new Date(e))}));var F=g().key((function(e){return e.day})).rollup((function(e){return y(e,(function(e){return parseInt(e.legalFiles.length)}))})).object(e);var j=l().domain(b(e,(function(e){return parseInt(e.legalFiles.length)}))).range([.4,1]);$.filter((function(e){return e in F})).style("fill",(function(e){return x(j(F[e]))})).select("title").text((function(e){return D(new Date(e))+":  "+F[e]}));let A=3;C.selectAll("rect.cross").data((function(e,t){return d(e,new Date(e.getFullYear(),e.getMonth()+1,1))})).enter().append("rect").attr("class","cross").attr("width",f/2).attr("height",f/2).attr("rx",A).attr("ry",A).attr("y",(function(e){return m(e)*f+m(e)*s+f/2-A+s})).attr("x",(function(e){return(p(e)-p(new Date(e.getFullYear(),e.getMonth(),1)))*f+(p(e)-p(new Date(e.getFullYear(),e.getMonth(),1)))*s+f/2-A+s/2})).attr("fill",(function(e){const n=t.formatDate(new Date(e));if(t.creationDates.some((e=>e.day===n&&e.withPeriods))){return"#439347"}else{return"#bc0000"}})).style("display",(function(e){const n=t.formatDate(new Date(e));if(t.creationDates.some((e=>e.day===n))){return"block"}else{return"none"}})).on("mouseover",(function(e){w(".day").classed("hover",(function(t){if(e===t){return true}else{return false}}))})).on("mouseout",(function(e){w(".day").classed("hover",(function(t){if(e===t){return false}else{return false}}))})).on("click",(function(e){const n=t.formatDate(new Date(e));let r=t.data.find((e=>e&&e.day&&String(e.day)===n));if(r){t.dayClicked.emit(r)}else{t.dayClicked.emit({day:n,legalFiles:[]})}})).datum(v);if(!this.haveLegend){let e=[];let t;let n;if(F){for(const e of Object.keys(F)){if(!t)t=F[e];if(!n)n=F[e];if(F[e]<t){t=F[e]}if(F[e]>n){n=F[e]}}e.push(t);if(t!==n){e.push(n)}}let r=a(`#legend-${this.idChart}`).append("svg").attr("id","key").attr("class","key").attr("height",40).attr("width",(()=>88*k.length)).append("g").attr("transform",(function(e){return"translate("+30+","+(20-f*1.5)+")"}));if(e[0]){r.selectAll("rect").data(e).enter().append("rect").attr("width",f).attr("height",f).attr("x",(function(e,t){return t*50})).attr("fill",(function(e){return x(j(e))}));r.selectAll("text").data(e).enter().append("text").attr("x",(function(e,t){return f+5+t*50})).attr("y","0.8em").text((e=>e));r.append("text").attr("x",(()=>e.length*50)).attr("y","0.8em").text(": Nombre de fichier couvrant une journée")}r.append("rect").attr("class","cross").attr("width",f/2).attr("height",f/2).attr("rx",A).attr("ry",A).attr("fill","#439347").attr("x",(()=>{if(e.length){return e.length*50/2}else{return 50/2}})).attr("y","24");r.append("text").attr("x",(()=>{if(e.length){return e.length*50}else{return 50}})).attr("y","30").text(": Date de téléchargement d'un fichier");this.haveLegend=true}}render(){return n("div",null,n("div",{id:this.idChart}),n("div",{id:`legend-${this.idChart}`}))}get el(){return r(this)}static get watchers(){return{legalFiles:["onChangeLegalFiles"],start:["onChangeStart"],end:["onChangeEnd"],language:["onChangeLanguage"]}}};C.style=k;export{C as s3p_legal_files};
//# sourceMappingURL=p-a84835a2.entry.js.map