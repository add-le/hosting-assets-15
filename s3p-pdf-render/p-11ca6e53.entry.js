import{r as l,h as n,H as i}from"./p-d5a6e412.js";import{b as t}from"./p-6f5893c5.js";import{g as e}from"./p-4d1c1db0.js";import"./p-3e8ff66b.js";var s;(function(l){function n(l){return l.toLowerCase().split(" ").map((l=>l.charAt(0).toUpperCase()+l.slice(1))).join(" ")}l.toTitleCase=n})(s||(s={}));const u=".prepaid-report{font-family:Helvetica, sans-serif;font-size:15px}.prepaid-report-header{border:2px solid black;border-radius:15px;padding:3px;display:flex;flex-direction:column;gap:4px;margin-bottom:8px}.prepaid-report-footer{display:flex;flex-direction:row;justify-content:space-between;font-size:11px;margin-top:10px}.invisible-cell{border:none !important;background-color:white !important}.prepaid-report-header-line{display:flex;flex-direction:row;justify-content:space-between}.prepaid-report-table{font-family:Helvetica, sans-serif;font-size:12px;margin-left:auto;margin-right:auto;width:100%;border-collapse:collapse}.prepaid-report-thead>th{border:1px solid black;font-weight:normal;border-collapse:collapse}.prepaid-report-tbody td{border:1px solid black;font-weight:normal;text-align:right;box-sizing:border-box;border-collapse:collapse}";const r=class{constructor(n){l(this,n);this.log=t("S3pPrepaidReport");this.locale="fr-FR";this.json=undefined;this.index=undefined}async componentWillLoad(){if(this.json==null||this.index==null){this.log("You must set json and index prop.");return}this.start=new Date;this.start.setUTCHours(0,0,0,0);this.start.setUTCFullYear(this.json.year,this.json.month-1,1);this.stop=new Date;this.stop.setUTCHours(23,59,59,999);this.stop.setUTCFullYear(this.json.year,this.json.month,0);const l=Array.from({length:this.stop.getUTCDate()},((l,n)=>n+1));const n=this.json.drivers[this.index].periods.map((l=>new Date(l.ts).getDate()));const i=l.filter((l=>!n.includes(l)));for(const l of i){const n=new Date;n.setUTCFullYear(this.json.year,this.json.month-1,l);this.json.drivers[this.index].periods.push(this.generateMissingDay(n))}this.json.drivers[this.index].periods=this.json.drivers[this.index].periods.sort(((l,n)=>Date.parse(l.ts)-Date.parse(n.ts)));const t=this.json.drivers[this.index].periods.reduce(((l,n)=>{const i=e(new Date(n.ts));const t=l[i]||[];t.push(n);l[i]=t;return l}),{});const s=this.generateMonthSummary();for(const[l,n]of Object.entries(t)){const i=n[n.length-1];const t=this.json.drivers[this.index].periods.findIndex((l=>l.ts===i.ts));if(t>-1){this.json.drivers[this.index].periods.splice(t+1,0,this.generateWeekSummary(Number.parseInt(l),n))}}this.json.drivers[this.index].periods.push(s);this.json.drivers[this.index].periods.push(this.generatePeriodSummary())}componentDidLoad(){const l=document.createElement("div");l.id="waiting";document.body.appendChild(l)}generateMonthSummary(){const l=new Date(this.json.year,this.json.month-1);const n={ts:s.toTitleCase(l.toLocaleString(this.locale,{month:"long"})),_tsType:"string",kms:0,absNR:null,absRem:null,available:null,availableDE:null,driving:null,end:null,expenses:{bonus:null,evening:null,lunch:null,morning:null,night:null,total:null,unique:null},hdRem:null,matAM:null,night:null,service:null,serviceGlobal:null,start:null,working:null};for(const l of this.json.drivers[this.index].periods){n.driving+=l.driving;n.working+=l.working;n.available+=l.available;n.service+=l.service;n.night+=l.night;n.kms+=l.kms;n.serviceGlobal+=l.serviceGlobal;n.expenses.bonus+=l.expenses.bonus;n.expenses.evening+=l.expenses.evening;n.expenses.lunch+=l.expenses.lunch;n.expenses.morning+=l.expenses.morning;n.expenses.night+=l.expenses.night;n.expenses.total+=l.expenses.total;n.expenses.unique+=l.expenses.unique}return n}generatePeriodSummary(){const l={ts:"Période",_tsType:"string",kms:0,absNR:null,absRem:null,available:null,availableDE:null,driving:null,end:null,expenses:{bonus:null,evening:null,lunch:null,morning:null,night:null,total:null,unique:null},hdRem:null,matAM:null,night:null,service:null,serviceGlobal:null,start:null,working:null};for(const n of this.json.drivers[this.index].periods){l.driving+=n.driving;l.working+=n.working;l.available+=n.available;l.service+=n.service;l.night+=n.night;l.kms+=n.kms;l.serviceGlobal+=n.serviceGlobal;l.expenses.bonus+=n.expenses.bonus;l.expenses.evening+=n.expenses.evening;l.expenses.lunch+=n.expenses.lunch;l.expenses.morning+=n.expenses.morning;l.expenses.night+=n.expenses.night;l.expenses.total+=n.expenses.total;l.expenses.unique+=n.expenses.unique}return l}generateWeekSummary(l,n){const i={ts:`Semaine ${l.toString().padStart(2,"0")}`,_tsType:"string",kms:0,absNR:null,absRem:null,available:null,availableDE:null,driving:null,end:null,expenses:{bonus:null,evening:null,lunch:null,morning:null,night:null,total:null,unique:null},hdRem:null,matAM:null,night:null,service:null,serviceGlobal:null,start:null,working:null};for(const l of n){i.driving+=l.driving;i.working+=l.working;i.available+=l.available;i.service+=l.service;i.night+=l.night;i.kms+=l.kms;i.serviceGlobal+=l.serviceGlobal;i.expenses.bonus+=l.expenses.bonus;i.expenses.evening+=l.expenses.evening;i.expenses.lunch+=l.expenses.lunch;i.expenses.morning+=l.expenses.morning;i.expenses.night+=l.expenses.night;i.expenses.total+=l.expenses.total;i.expenses.unique+=l.expenses.unique}return i}generateMissingDay(l){return{ts:l.toISOString().split("T")[0],_tsType:"date",kms:0,absNR:null,absRem:null,available:null,availableDE:null,driving:null,end:null,expenses:{bonus:null,evening:null,lunch:null,morning:null,night:null,total:null,unique:null},hdRem:null,matAM:null,night:null,service:null,serviceGlobal:null,start:null,working:null}}getRowColor(l){if(l.includes("Semaine")){return"#e2e2fa"}else if(l.includes("Période")){return"#9393fb"}else{return"#c5c5fb"}}render(){var l,t,e,s,u,r,o,a,d;return n(i,{class:"prepaid-report"},n("header",{class:"prepaid-report-header"},n("div",{class:"prepaid-report-header-line"},n("span",null,"Société : ",(l=this.json)===null||l===void 0?void 0:l.legalStructure," - ",(t=this.json)===null||t===void 0?void 0:t.siret),n("span",null,n("b",null,"Synthèse des disques et frais"))),n("div",{class:"prepaid-report-header-line"},n("span",null,"Conducteur : ",(e=this.json)===null||e===void 0?void 0:e.drivers[this.index].lastName.toUpperCase()," ",(s=this.json)===null||s===void 0?void 0:s.drivers[this.index].firstName.toUpperCase()),n("span",null,n("b",null,"Du ",(u=this.start)===null||u===void 0?void 0:u.toLocaleDateString(this.locale,{timeZone:"UTC"})," au ",(r=this.stop)===null||r===void 0?void 0:r.toLocaleDateString(this.locale,{timeZone:"UTC"})))),n("div",{class:"prepaid-report-header-line"},n("span",null,"Matricule : ",(a=(o=this.json)===null||o===void 0?void 0:o.drivers[this.index].socialExternalId)!==null&&a!==void 0?a:"N/A"))),n("main",null,n("table",{class:"prepaid-report-table",cellspacing:"0"},n("thead",{class:"prepaid-report-thead"},n("th",{class:"invisible-cell"}),n("th",null,"Début"),n("th",null,"Fin"),n("th",null,"Conduite"),n("th",null,"Travail"),n("th",null,"Dispo"),n("th",null,"Disp DE"),n("th",null,"Service"),n("th",null,"HD rem"),n("th",null,"Abs rem"),n("th",null,"Abs nr"),n("th",null,"Mat/AM"),n("th",null,"Nuit"),n("th",null,"Kms"),n("th",null,"Serv global"),n("th",{class:"invisible-cell"}),n("th",null,"Pt. D"),n("th",null,"Déj"),n("th",null,"Dîner"),n("th",null,"Nuit"),n("th",null,"Divers"),n("th",null,"Total"),n("th",null,"Prime")),n("tbody",{class:"prepaid-report-tbody"},(d=this.json)===null||d===void 0?void 0:d.drivers[this.index].periods.map((l=>{var i,t,e,s,u,r,o,a;const d=new Date(l.ts);if(l.available===0){l.available=null}if(l.night===0){l.night=null}if(l.expenses.morning===0){l.expenses.morning=null}if(l.expenses.bonus===0){l.expenses.bonus=null}if(l.expenses.evening===0){l.expenses.evening=null}if(l.expenses.lunch===0){l.expenses.lunch=null}if(l.expenses.night===0){l.expenses.night=null}if(l.expenses.night===0){l.expenses.night=null}if(l.expenses.unique===0){l.expenses.unique=null}if(l.expenses.total===0){l.expenses.total=null}return n("tr",{style:{backgroundColor:l._tsType==="string"?this.getRowColor(l.ts):"none"}},n("td",null,l._tsType==="string"?l.ts:d.toLocaleDateString(this.locale,{timeZone:"UTC",weekday:"short",year:"numeric",month:"numeric",day:"numeric"})),n("td",null,l.start),n("td",null,l.end),n("td",null,(i=l.driving)===null||i===void 0?void 0:i.toLocaleString(this.locale,{minimumFractionDigits:2,maximumFractionDigits:2})),n("td",null,(t=l.working)===null||t===void 0?void 0:t.toLocaleString(this.locale,{minimumFractionDigits:2,maximumFractionDigits:2})),n("td",null,(e=l.available)===null||e===void 0?void 0:e.toLocaleString(this.locale,{minimumFractionDigits:2,maximumFractionDigits:2})),n("td",null,l.availableDE),n("td",null,(s=l.service)===null||s===void 0?void 0:s.toLocaleString(this.locale,{minimumFractionDigits:2,maximumFractionDigits:2})),n("td",null,l.hdRem),n("td",null,l.absRem),n("td",null,l.absNR),n("td",null,l.matAM),n("td",null,(u=l.night)===null||u===void 0?void 0:u.toLocaleString(this.locale,{minimumFractionDigits:2,maximumFractionDigits:2})),n("td",null,l.kms),n("td",null,(r=l.serviceGlobal)===null||r===void 0?void 0:r.toLocaleString(this.locale,{minimumFractionDigits:2,maximumFractionDigits:2})),n("td",{class:"invisible-cell"}),n("td",null,l.expenses.morning),n("td",null,l.expenses.lunch),n("td",null,l.expenses.evening),n("td",null,l.expenses.night),n("td",null,l.expenses.unique),n("td",null,(o=l.expenses.total)===null||o===void 0?void 0:o.toLocaleString(this.locale,{minimumFractionDigits:2,maximumFractionDigits:2})),n("td",null,(a=l.expenses.bonus)===null||a===void 0?void 0:a.toLocaleString(this.locale,{minimumFractionDigits:2,maximumFractionDigits:2})))}))))),n("footer",{class:"prepaid-report-footer"},n("span",null,n("i",null,"Généré le ","{{date}}"," ","{{time}}")),n("span",null,n("i",null,"Page ","{{currentPage}}","/","{{totalPage}}"))))}};r.style=u;export{r as s3p_prepaid_report};
//# sourceMappingURL=p-11ca6e53.entry.js.map